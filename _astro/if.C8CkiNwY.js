import{M as d,R as v,W as l,S as b,o as _,I as u,w as o,D as m,a9 as k,J as g,q as y,y as A,aa as T,A as w,H as E,B as M,v as R,C as p}from"./utils.CFVGCFTS.js";class D{anchor;#t=new Map;#s=new Map;#e=new Map;#a=!0;constructor(s,r=!0){this.anchor=s,this.#a=r}#r=()=>{var s=d;if(this.#t.has(s)){var r=this.#t.get(s),t=this.#s.get(r);if(t)v(t);else{var c=this.#e.get(r);c&&(this.#s.set(r,c.effect),this.#e.delete(r),c.fragment.lastChild.remove(),this.anchor.before(c.fragment),t=c.effect)}for(const[i,e]of this.#t){if(this.#t.delete(i),i===s)break;const a=this.#e.get(e);a&&(l(a.effect),this.#e.delete(e))}for(const[i,e]of this.#s){if(i===r)continue;const a=()=>{if(Array.from(this.#t.values()).includes(i)){var h=document.createDocumentFragment();k(e,h),h.append(_()),this.#e.set(i,{effect:e,fragment:h})}else l(e);this.#s.delete(i)};this.#a||!t?b(e,a,!1):a()}}};ensure(s,r){var t=d,c=g();if(r&&!this.#s.has(s)&&!this.#e.has(s))if(c){var i=document.createDocumentFragment(),e=_();i.append(e),this.#e.set(s,{effect:u(()=>r(e)),fragment:i})}else this.#s.set(s,u(()=>r(this.anchor)));if(this.#t.set(t,s),c){for(const[a,f]of this.#s)a===s?t.skipped_effects.delete(f):t.skipped_effects.add(f);for(const[a,f]of this.#e)a===s?t.skipped_effects.delete(f.effect):t.skipped_effects.add(f.effect);t.add_callback(this.#r)}else o&&(this.anchor=m),this.#r()}}function S(n,s,r=!1){o&&A();var t=new D(n),c=r?T:0;function i(e,a){if(o){const h=w(n)===E;if(e===h){var f=M();R(f),t.anchor=f,p(!1),t.ensure(e,a),p(!0);return}}t.ensure(e,a)}y(()=>{var e=!1;s((a,f=!0)=>{e=!0,i(f,a)}),e||i(!1,null)},c)}export{S as i};
